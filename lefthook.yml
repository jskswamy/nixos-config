# Lefthook configuration
# Install hooks: nix run nixpkgs#lefthook -- install

pre-commit:
  parallel: true
  commands:
    gitleaks:
      # Scan staged changes for secrets, redact potential findings
      run: nix run nixpkgs#gitleaks -- git --staged --redact
    # nixfmt:
    #   # Format staged .nix files
    #   files: git ls-files '*.nix'
    #   run: nix run nixpkgs#nixpkgs-fmt -- {staged_files}
    # statix:
    #   # Static analysis for Nix code
    #   run: nix run nixpkgs#statix -- check
    # deadnix:
    #   # Detect unused Nix code; fail CI on findings
    #   run: nix run nixpkgs#deadnix -- --fail

prepare-commit-msg:
  # Do not generate/modify messages during merges/rebases
  skip:
    - merge
    - rebase
    - merge-commit
  commands:
    fabric_generate:
      # Generate a commit message from the staged diff using Fabric (optional helper).
      # Uses nix to ensure reproducibility and no global install requirement.
      run: |
        git diff --cached | nix run nixpkgs#fabric-ai -- --pattern git_commit_message > {1}